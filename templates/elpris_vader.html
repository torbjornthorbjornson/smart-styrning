
{% extends "base.html" %}

{% block content %}

<h2>Elpris & V√§der</h2>

<form method="get">
  <label for="datum">V√§lj datum:</label>
  <input type="date" id="datum" name="datum" value="{{ selected_date }}">
  <button type="submit">Visa</button>
</form>

<p style="font-weight:bold; color:#333;">
  Visar v√§der f√∂r: {{ weather_date }}<br>
  Visar elpris f√∂r: {{ selected_date }}
</p>

{% if fallback_used %}
  <p style="color:orange;"><strong>‚ö†Ô∏è Morgondagens elpriser har inte publicerats √§nnu. Visar ist√§llet g√•rdagens ({{ selected_date }})</strong></p>
{% endif %}

<!-- Ikonrad -->
<div class="icon-row">
  {% for row in weatherdata %}
    <div class="icon-cell">
      {% set icon_path = 'weather-icons/' + row.symbol_code + '.svg' %}
      <img src="{{ url_for('static', filename=icon_path) }}" alt="{{ row.symbol_code }}"
           title="{{ row.symbol_code }}" onerror="this.outerHTML='‚ùì'" class="weather-icon">
      <div class="icon-hour">{{ row.timestamp.strftime('%H:%M') }}</div>
    </div>
  {% endfor %}
</div>

{% if weatherdata %}
  <p style="font-weight:bold; color:#333;">
    üå¶Ô∏è V√§derprognos fr√•n MET f√∂r {{ weatherdata[0].timestamp.date() }}
  </p>
{% else %}
  <p style="color: orange;">‚ö†Ô∏è Ingen v√§derdata tillg√§nglig.</p>
{% endif %}


<!-- V√§dergraf -->
<h3>Temperatur & Vind</h3>
<canvas id="weatherChart" width="100%" height="40"></canvas>

<!-- V√§dertabell -->
<h3 style="margin-top:40px;">V√§derdata</h3>
<table>
  <thead>
    <tr>
      <th>Tid</th>
      <th>Temp (¬∞C)</th>
      <th>Vind (m/s)</th>
      <th>Symbol</th>
    </tr>
  </thead>
  <tbody>
    {% for row in weatherdata %}
    <tr>
      <td>{{ row.timestamp.strftime('%H:%M') }}</td>
      <td>{{ row.temperature }}</td>
      <td>{{ row.vind }}</td>
      <td>
        {% set icon_path = 'weather-icons/' + row.symbol_code + '.svg' %}
        <img src="{{ url_for('static', filename=icon_path) }}" alt="{{ row.symbol_code }}"
             title="{{ row.symbol_code }}" onerror="this.outerHTML='‚ùì'" class="weather-icon-small">
        {{ row.symbol_code }}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Elprisgraf -->
<h3 style="margin-top:40px;">Elpris</h3>
{% if fallback_used %}
  <p style="color: orange;">
    üî∂ Morgondagens elpriser √§r inte tillg√§ngliga √§nnu.<br>
    ‚è≥ De sl√§pps vanligtvis varje dag kl 13:00 av Nordpool (day-ahead).<br>
    üìÖ Visar dagens elpriser ({{ selected_date }}).
  </p>
{% else %}
  <p style="color: green;">
    ‚úÖ Visar aktuella elpriser f√∂r idag ({{ selected_date }})<br>
    üìÖ Publicerades av Nordpool: üìÖ Publicerades av Nordpool: {{ date_yesterday }} kl 13:00

  </p>
{% endif %}

{% if elprisdata %}
<canvas id="elprisChart" width="100%" height="40"></canvas>
{% else %}
<p style="color: red;">‚ö†Ô∏è Ingen elprisdata tillg√§nglig f√∂r valt datum.</p>
{% endif %}

<!-- Elpristabell -->
<h3 style="margin-top:40px;">Elpriser</h3>
{% if elprisdata %}
<table class="data-table">
  <thead>
    <tr>
      <th>Tid</th>
      <th style="text-align: right;">Pris (√∂re/kWh)</th>
    </tr>
  </thead>
  <tbody>
    {% for row in elprisdata %}
    <tr>
      <td>{{ row.datetime.strftime('%H:%M') }}</td>
      <td style="text-align: right;">{{ row.price }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<p style="color: red;">‚ö†Ô∏è Inga elpriser att visa.</p>
{% endif %}


<!-- Medelv√§rden -->
<h3 style="margin-top:40px;">Medelv√§rden</h3>
<ul>
  <li>üå°Ô∏è Temperatur: {{ medel_temperature }} ¬∞C</li>
  <li>üí® Vind: {{ medel_vind }} m/s</li>
  <li>‚ö° Elpris: {{ medel_elpris }} √∂re/kWh</li>
</ul>

<script>
const ctx1 = document.getElementById('weatherChart').getContext('2d');
new Chart(ctx1, {
    type: 'line',
    data: {
        labels: {{ labels|tojson }},
        datasets: [
            {
                label: 'Temperatur (¬∞C)',
                data: {{ temperature|tojson }},
                borderColor: 'red',
                tension: 0.3
            },
            {
                label: 'Vind (m/s)',
                data: {{ vind|tojson }},
                borderColor: 'blue',
                tension: 0.3
            }
        ]
    }
});

{% if elprisdata %}
const ctx2 = document.getElementById('elprisChart').getContext('2d');
new Chart(ctx2, {
    type: 'line',
    data: {
        labels: {{ elpris_labels|tojson }},
        datasets: [
            {
                label: 'Elpris (√∂re/kWh)',
                data: {{ elpris_values|tojson }},
                borderColor: 'green',
                tension: 0.3
            }
        ]
    }
});
{% endif %}

</script>
<style>
  .icon-row {
    display: flex;
    justify-content: space-between;
    flex-wrap: nowrap;
    overflow-x: auto;
    margin: 20px 0;
  }
  .icon-cell {
    text-align: center;
    width: 40px;
    font-size: 12px;
  }
  .weather-icon {
    width: 32px;
    height: 32px;
  }
  .weather-icon-small {
    width: 24px;
    height: 24px;
    vertical-align: middle;
  }
  .icon-hour {
    font-size: 10px;
    margin-top: 4px;
  }
  
  /* üÜï Tabellstil f√∂r elpris ‚Äì inuti <style>! */
  .data-table {
    border-collapse: collapse;
    width: 100%;
    margin-top: 10px;
    font-size: 0.95em;
  }
  
  .data-table th, .data-table td {
    padding: 8px 16px;
  }
  
  .data-table thead {
    background-color: #f0f0f0;
    font-weight: bold;
    border-bottom: 1px solid #ccc;
  }
  
  .data-table tbody tr:nth-child(odd) {
    background-color: #fafafa;
  }
  </style>
  

{% endblock %}
