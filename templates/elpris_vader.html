{% extends "layout.html" %}
{% block content %}
<h2>üìà Elpris & V√§der f√∂r {{ selected_date }}</h2>
<form method="get" action="/elprisvader">
    <label for="datum">V√§lj datum:</label>
    <input type="date" id="datum" name="datum" value="{{ selected_date }}">
    <button type="submit">Visa</button>
</form>

<canvas id="weatherChart"></canvas>
<canvas id="elprisChart"></canvas>

<h3>‚òÄÔ∏è V√§derdata</h3>
<table>
    <tr>
        <th>Tid</th>
        <th>Temperatur (¬∞C)</th>
        <th>Vind (m/s)</th>
        <th>Symbol</th>
    </tr>
    {% for row in weatherdata %}
    <tr>
        <td>{{ row.timestamp.strftime('%H:%M') }}</td>
        <td>{{ row.temperature }}</td>
        <td>{{ row.vind }}</td>
        <td>{{ row.symbol_code }}</td>
    </tr>
    {% endfor %}
</table>

<h3>‚ö° Elpriser ({{ selected_date + timedelta(days=1) }})</h3>
<table>
    <tr>
        <th>Tid</th>
        <th>Elpris (√∂re/kWh)</th>
    </tr>
    {% for row in elprisdata %}
    <tr>
        <td>{{ row.datetime.strftime('%H:%M') }}</td>
        <td>{{ row.price }}</td>
    </tr>
    {% endfor %}
</table>

<h3>üìä Medelv√§rden</h3>
<ul>
    <li>Temperatur: {{ avg_temp }} ¬∞C</li>
    <li>Vind: {{ avg_wind }} m/s</li>
    <li>Elpris: {{ avg_price }} √∂re/kWh</li>
</ul>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const weatherdata = {{ weatherdata_json | safe }};
    const elprisdata = {{ elprisdata_json | safe }};

    const weatherLabels = weatherdata.map(row => row.timestamp.substring(11, 16));
    const temperatureData = weatherdata.map(row => row.temperature);
    const windData = weatherdata.map(row => row.vind);

    const elprisLabels = elprisdata.map(row => row.datetime.substring(11, 16));
    const priceData = elprisdata.map(row => row.price);

    new Chart(document.getElementById('weatherChart'), {
        type: 'line',
        data: {
            labels: weatherLabels,
            datasets: [
                {
                    label: 'Temperatur (¬∞C)',
                    data: temperatureData,
                    borderColor: 'red',
                    fill: false
                },
                {
                    label: 'Vind (m/s)',
                    data: windData,
                    borderColor: 'blue',
                    fill: false
                }
            ]
        }
    });

    new Chart(document.getElementById('elprisChart'), {
        type: 'line',
        data: {
            labels: elprisLabels,
            datasets: [{
                label: 'Elpris (√∂re/kWh)',
                data: priceData,
                borderColor: 'green',
                fill: false
            }]
        }
    });
</script>
{% endblock %}
